<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gestione Hospitality</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
body {
    font-family: 'Inter', sans-serif;
    background-color: #F7F7F7;
}
.fade-in {
    animation: fadeIn 0.4s ease-in-out;
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}
.btn-primary {
    background-color: #e11d48;
    color: white;
    font-weight: 500;
    padding: 0.75rem 1rem;
    border-radius: 0.75rem;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.5rem;
    transition: background-color 0.2s;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
}
.btn-primary:hover { background-color: #be123c; }
.input-field {
    width: 100%;
    border: 1px solid #d1d5db;
    border-radius: 0.5rem;
    padding: 0.75rem 1rem;
}
.input-field:focus {
    outline: none;
    border-color: #f43f5e;
    box-shadow: 0 0 0 2px rgba(244,63,94,0.3);
}
.card {
    background: white;
    border-radius: 0.75rem;
    border: 1px solid #f1f1f1;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    overflow: hidden;
}
.tab-btn {
    flex: 1;
    padding: 0.75rem;
    font-size: 0.875rem;
    font-weight: 500;
    text-align: center;
    color: #6b7280;
    border-bottom: 2px solid transparent;
}
.tab-btn.active {
    color: #e11d48;
    border-color: #e11d48;
}
</style>
</head>

<body class="text-gray-800 pb-20">

<!-- LOGIN -->
<section id="login-screen" class="min-h-screen flex items-center justify-center p-4">
<div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-sm fade-in">
    <div class="text-center mb-8">
        <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-rose-100 text-rose-600 mb-4">
            <i data-lucide="building-2"></i>
        </div>
        <h1 class="text-2xl font-bold">Gestione Staff</h1>
        <p class="text-gray-500 mt-2 text-sm">Accesso Riservato</p>
    </div>

    <div class="space-y-4">
        <div>
            <label class="text-xs font-bold text-gray-500 uppercase">Utente</label>
            <input id="email" class="input-field" placeholder="admin">
        </div>
        <div>
            <label class="text-xs font-bold text-gray-500 uppercase">Password</label>
            <input id="password" type="password" class="input-field" placeholder="2026">
        </div>
        <button onclick="handleLogin()" class="btn-primary">Accedi</button>
    </div>

    <div id="login-error" class="hidden mt-4 p-3 bg-red-50 text-red-600 text-sm rounded-lg text-center"></div>
</div>
</section>

<!-- DASHBOARD -->
<section id="dashboard-screen" class="hidden min-h-screen">
<nav class="bg-white border-b px-6 py-4 flex justify-between items-center">
    <span class="font-bold text-rose-600 flex gap-2"><i data-lucide="layout-grid"></i> GestorePro</span>
    <button onclick="logout()"><i data-lucide="log-out"></i></button>
</nav>

<main class="max-w-xl mx-auto mt-6 px-4">
    <h2 class="text-xl font-bold mb-4">Le tue Strutture</h2>
    <div id="loading-structures" class="text-center py-10 text-gray-400">Connessione al DB...</div>
    <div id="structures-grid" class="grid gap-4"></div>
</main>
</section>

<!-- DETTAGLIO -->
<section id="detail-screen" class="hidden min-h-screen bg-gray-50">
<header class="bg-white border-b">
<div class="px-4 py-3 flex gap-3 items-center">
    <button onclick="goHome()"><i data-lucide="arrow-left"></i></button>
    <div>
        <h2 id="detail-title" class="font-bold"></h2>
        <p class="text-xs text-gray-500">Pannello Operativo</p>
    </div>
</div>
<div class="flex">
    <button id="tab-inventory" onclick="switchTab('inventory')" class="tab-btn active">Inventario</button>
    <button id="tab-orders" onclick="switchTab('orders')" class="tab-btn">Ordini</button>
    <button id="tab-info" onclick="switchTab('info')" class="tab-btn">Info</button>
</div>
</header>

<main class="max-w-xl mx-auto p-4">
<div id="view-inventory">
    <div id="inventory-list" class="space-y-3"></div>
    <input id="operator-signature" class="input-field mt-4" placeholder="Firma operatore">
    <button onclick="saveInventory()" class="btn-primary mt-3">Salva Inventario</button>
</div>

<div id="view-orders" class="hidden">
    <div id="orders-list" class="space-y-3"></div>
</div>

<div id="view-info" class="hidden card p-4">
    <p><strong>Indirizzo:</strong> <span id="info-address"></span></p>
    <p class="mt-2 whitespace-pre-line" id="info-codes"></p>
</div>
</main>
</section>

<script>
const SUPABASE_URL = "https://nqmbxdyikwwpqbdasgmn.supabase.co";
const SUPABASE_KEY = "INSERISCI_LA_TUA_KEY";
let supabase;
let currentStructure;
let productsList = [];

document.addEventListener("DOMContentLoaded", () => {
    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    lucide.createIcons();
});

function handleLogin() {
    const u = email.value.trim();
    const p = password.value.trim();
    if (u === "admin" && p === "2026") {
        login-screen.classList.add("hidden");
        dashboard-screen.classList.remove("hidden");
        loadStructures();
    } else {
        login-error.innerText = "Credenziali errate";
        login-error.classList.remove("hidden");
    }
}

function logout() { location.reload(); }

async function loadStructures() {
    const { data } = await supabase.from("structures").select("*");
    loading-structures.classList.add("hidden");
    structures-grid.innerHTML = "";
    data.forEach(s => {
        const d = document.createElement("div");
        d.className = "card p-4 cursor-pointer";
        d.innerHTML = `<h3 class="font-bold">${s.name}</h3><p class="text-sm">${s.address||""}</p>`;
        d.onclick = () => openStructure(s);
        structures-grid.appendChild(d);
    });
}

async function openStructure(s) {
    currentStructure = s;
    dashboard-screen.classList.add("hidden");
    detail-screen.classList.remove("hidden");
    detail-title.innerText = s.name;
    info-address.innerText = s.address || "-";
    info-codes.innerText = s.access_info || "-";
    await loadProducts();
}

function goHome() {
    detail-screen.classList.add("hidden");
    dashboard-screen.classList.remove("hidden");
}

async function loadProducts() {
    const { data } = await supabase.from("products").select("*");
    productsList = data || [];
    inventory-list.innerHTML = "";
    productsList.forEach(p => {
        inventory-list.innerHTML += `
        <div class="card p-3 flex justify-between">
            <span>${p.name}</span>
            <input id="inv-${p.id}" type="number" class="w-16 border rounded text-center">
        </div>`;
    });
}

async function saveInventory() {
    const name = operator-signature.value.trim();
    if (!name) return alert("Firma obbligatoria");
    const { data } = await supabase.from("inventories").insert({
        structure_id: currentStructure.id,
        operator_name: name
    }).select();
    const invId = data[0].id;
    const items = productsList.map(p => ({
        inventory_id: invId,
        product_name: p.name,
        quantity: parseInt(document.getElementById(`inv-${p.id}`).value) || 0
    })).filter(i => i.quantity > 0);
    if (items.length) await supabase.from("inventory_items").insert(items);
    alert("Inventario salvato");
}

function switchTab(t) {
    ["inventory","orders","info"].forEach(x=>{
        document.getElementById(`view-${x}`).classList.add("hidden");
        document.getElementById(`tab-${x}`).classList.remove("active");
    });
    document.getElementById(`view-${t}`).classList.remove("hidden");
    document.getElementById(`tab-${t}`).classList.add("active");
}
</script>
</body>
</html>